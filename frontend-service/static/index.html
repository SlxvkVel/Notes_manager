<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–º–µ—Ç–æ–∫</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        input, textarea, button { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .note { border: 1px solid #eee; padding: 10px; margin: 10px 0; background: #f9f9f9; }
        .auth-buttons { display: flex; gap: 10px; }
        .auth-buttons button { flex: 1; }
    </style>
</head>
<body>
    <h1>üìù –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–º–µ—Ç–æ–∫</h1>
    
    <div class="container">
        <h3>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
        <div class="auth-buttons">
            <button onclick="register()">–ê–≤—Ç–æ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            <button onclick="login()">–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</button>
            <button onclick="logout()">–í—ã—Ö–æ–¥</button>
        </div>
    </div>

    <div class="container">
        <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É</h3>
        <input type="text" id="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–º–µ—Ç–∫–∏">
        <textarea id="content" placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏" rows="4"></textarea>
        <button onclick="createNote()">–°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
    </div>

    <div class="container">
        <h3>–ú–æ–∏ –∑–∞–º–µ—Ç–∫–∏</h3>
        <button onclick="getNotes()">–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
        <div id="notes"></div>
    </div>

    <script>
        function generateRandomUser() {
            const randomId = Math.floor(Math.random() * 10000);
            return {
                username: 'user_' + randomId,
                email: 'test' + randomId + '@example.com',
                password: 'password123'
            };
        }

        async function register() {
            const user = generateRandomUser();
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify(user)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                alert(`‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!\n\nEmail: ${user.email}\nPassword: ${user.password}`);
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
            }
        }

        async function login() {
            const email = prompt('–í–≤–µ–¥–∏—Ç–µ email:');
            const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:');
            
            if (!email || !password) return;
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify({email, password})
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                alert('‚úÖ –õ–æ–≥–∏–Ω —É—Å–ø–µ—à–µ–Ω!');
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ª–æ–≥–∏–Ω–∞: ' + error.message);
            }
        }

        async function createNote() {
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            
            if (!title || !content) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏');
                return;
            }
            
            try {
                const response = await fetch('/api/notes', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'include',
                    body: JSON.stringify({
                        title: title,
                        content: content
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                alert('‚úÖ –ó–∞–º–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!');
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
                document.getElementById('title').value = '';
                document.getElementById('content').value = '';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                getNotes();
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏: ' + error.message);
            }
        }

        async function getNotes() {
            try {
                const response = await fetch('/api/notes/list', {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                displayNotes(data.notes);
            } catch (error) {
                document.getElementById('notes').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫';
            }
        }

        function displayNotes(notes) {
            const container = document.getElementById('notes');
            if (!notes || notes.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫</p>';
                return;
            }
            
            container.innerHTML = notes.map(note => `
                <div class="note">
                    <h4>${note.title}</h4>
                    <p>${note.content}</p>
                    <small>–°–æ–∑–¥–∞–Ω–æ: ${new Date(note.created_at).toLocaleString()}</small>
                </div>
            `).join('');
        }

        async function logout() {
            try {
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                alert('‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
                document.getElementById('notes').innerHTML = '';
            } catch (error) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ' + error);
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–º–µ—Ç–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = getNotes;
    </script>
</body>
</html>